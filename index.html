<!DOCTYPE html>
<html lang="es"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
  <title>Mi Diario Personal</title> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.12/sweetalert2.min.css"> 
  <style>
    :root {
      --primary: #4e54c8;
      --secondary: #8f94fb;
      --accent: #6a82fb;
      --text: #333;
      --bg: #f8f9fa;
      --card-bg: #ffffff;
      --border: #e0e0e0;
      --shadow: rgba(0, 0, 0, 0.1);
      --footer: #222;
      --footer-text: #fff;
      --header-bg: linear-gradient(to right, var(--primary), var(--secondary));
      --gold: #FFD700;
    }

    .dark-mode {
      --primary: #7579e7;
      --secondary: #9ab3f5;
      --accent: #a3d8f4;
      --text: #e0e0e0;
      --bg: #121212;
      --card-bg: #1e1e1e;
      --border: #333;
      --shadow: rgba(0, 0, 0, 0.3);
      --footer: #111;
      --footer-text: #ddd;
      --header-bg: linear-gradient(to right, #2c2c54, #474787);
      --gold: #FFD700;
    }

    * {
      box-sizing: border-box;
      transition: background 0.3s, color 0.3s;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      
    }

    header {
      background: var(--header-bg);
      color: white;
      padding: 15px 20px;
      text-align: center;
      box-shadow: 0 2px 10px var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    header h1 {
      margin: 0;
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    header h1 i {
      margin-right: 10px;
      font-size: 1.5rem;
    }

    .container {
  max-width: 800px;
  margin: 20px auto;
  padding: 15px;
  min-height: calc(100vh - 120px); /* AÑADE esta línea */
  overflow-y: auto; /* AÑADE esta línea */
}

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px var(--shadow);
      border: 1px solid var(--border);
    }

    textarea, input[type="text"], input[type="password"], input[type="date"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--bg);
      color: var(--text);
      resize: vertical;
      font-family: inherit;
      margin-bottom: 10px;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      margin: 5px;
      transition: all 0.2s;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    .btn i {
      margin-right: 8px;
    }

    .btn-secondary {
      background: var(--secondary);
    }

    .btn-danger {
      background: #e74c3c;
    }

    .btn-warning {
      background: #f39c12;
    }

    .btn-success {
      background: #2ecc71;
    }

    .btn-info {
      background: #3498db;
    }

    #canvas-container {
      position: relative;
      margin-top: 10px;
      border-radius: 8px;
      overflow: hidden;
    }

    canvas {
      border: 1px solid var(--border);
      border-radius: 8px;
      background-color: white;
      max-width: 100%;
    }

    .tool-panel {
      display: flex;
      flex-wrap: wrap;
      margin: 10px 0;
    }

    .color-picker {
      width: 30px;
      height: 30px;
      border: none;
      border-radius: 50%;
      margin-right: 10px;
      cursor: pointer;
    }

   footer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--footer);
  color: var(--footer-text);
  display: flex;
  justify-content: space-around;
  padding: 12px 0;
  box-shadow: 0 -2px 10px var(--shadow);
  z-index: 999;
}

.container {
  max-width: 800px;
  margin: 20px auto;
  padding: 15px;
  padding-bottom: 80px; /* Espacio para el footer */
  min-height: calc(100vh - 60px);
  overflow-y: auto;
}

body {
  overflow-x: hidden;
  padding-bottom: 0; /* Asegúrate que no hay padding aquí */
}
    footer i {
      font-size: 22px;
      cursor: pointer;
      transition: all 0.3s;
    }

    footer i:hover {
      color: var(--accent);
      transform: translateY(-3px);
    }

    .active-nav {
      color: var(--accent);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #login {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .login-card {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    .login-card img {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
    }

    .login-card h2 {
      margin-top: 0;
      color: var(--primary);
    }

    .themes {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
    }

    .theme-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.2s;
      border: 2px solid transparent;
    }

    .theme-option:hover {
      transform: scale(1.1);
    }

    .theme-option.active {
      border-color: var(--primary);
    }

    .entries-list {
      max-height: 500px;
      overflow-y: auto;
    }

    .entry-item {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
    }

    .entry-item:hover {
      box-shadow: 0 3px 10px var(--shadow);
    }

    .entry-date {
      font-size: 0.9rem;
      color: var(--secondary);
      font-weight: bold;
    }

    .entry-preview {
      font-size: 0.9rem;
      margin-top: 5px;
      color: var(--text);
      opacity: 0.8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .quick-notes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .note {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px var(--shadow);
      width: calc(50% - 10px);
      position: relative;
      min-height: 100px;
      border: 1px solid var(--border);
    }

    .note textarea {
      border: none;
      background: transparent;
      width: 100%;
      height: 80px;
      resize: none;
      padding: 0;
      margin: 0;
      font-family: inherit;
      color: var(--text);
    }

    .note-actions {
      position: absolute;
      bottom: 5px;
      right: 5px;
      display: flex;
    }

    .note-actions i {
      padding: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .mode-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      background: transparent;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .search-bar {
      display: flex;
      margin-bottom: 15px;
    }

    .search-bar input {
      flex: 1;
      margin-right: 10px;
      margin-bottom: 0;
    }

    @media (max-width: 768px) {
      .note {
        width: 100%;
      }
    }

    .mood-selector {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      flex-wrap: wrap;
    }

    .mood {
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .mood:hover {
      transform: scale(1.2);
    }

    .selected-mood {
      background: var(--secondary);
      transform: scale(1.2);
    }

    .welcome-message {
      font-size: 1.2rem;
      text-align: center;
      margin: 20px 0;
      color: var(--primary);
    }

    .stats {
      display: flex;
      justify-content: space-around;
      text-align: center;
    }

    .stat {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      width: 30%;
      box-shadow: 0 3px 10px var(--shadow);
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text);
      opacity: 0.8;
    }

    /* Botones de control para canvas */
    .canvas-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
    }

    .canvas-controls button {
      padding: 8px 12px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      cursor: pointer;
    }

    .canvas-controls .color-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 1px solid var(--border);
      padding: 0;
    }

    .header-date {
      font-size: 0.9rem;
      margin-top: 5px;
      opacity: 0.9;
    }

    /* Estilo para el botón de borrador activo */
    #eraser-btn.active {
      background: var(--accent);
      color: white;
    }

    /* Estilo para el crédito */
    .credits {
      text-align: center;
      margin-top: 20px;
      font-size: 0.8rem;
      color: var(--text);
      opacity: 0.7;
      padding: 10px;
      border: 2px solid var(--gold);
      border-radius: 8px;
      background: linear-gradient(to right, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
    }

    /* Estilos para el teclado numérico */
    .numeric-keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .num-key {
      padding: 15px;
      font-size: 1.5rem;
      border: none;
      border-radius: 8px;
      background: var(--secondary);
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .num-key:hover {
      background: var(--primary);
      transform: translateY(-2px);
    }

    .pin-display {
      letter-spacing: 10px;
      font-size: 1.5rem;
      text-align: center;
      margin: 15px 0;
      min-height: 40px;
    }

    .pin-dot {
      display: inline-block;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--primary);
      margin: 0 5px;
    }

    .pin-input-container {
      position: relative;
    }

    .pin-input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    /* Nuevos estilos para secciones adicionales */
    .reminder-item {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: var(--bg);
      border: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .reminder-text {
      flex: 1;
    }

    .reminder-actions i {
      margin-left: 10px;
      cursor: pointer;
    }

    .habit-tracker {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 15px;
    }

    .habit-day {
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .habit-day.completed {
      background: var(--secondary);
      color: white;
    }

    /* Nuevo estilo para la galería de fotos */
    .photo-gallery {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .photo-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      height: 150px;
      border: 1px solid var(--border);
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-actions {
      position: absolute;
      bottom: 0;
      right: 0;
      background: rgba(0,0,0,0.5);
      padding: 5px;
      border-radius: 8px 0 0 0;
    }

    .photo-actions i {
      color: white;
      margin-left: 5px;
      cursor: pointer;
    }

    /* Estilos para el teclado compacto */
    .numeric-keypad.compact {
      gap: 5px;
      padding: 5px;
    }

    .num-key.compact {
      padding: 10px;
      font-size: 1.2rem;
    }

    /* Estilos para los métodos de seguridad */
    .security-method-selector {
      margin-bottom: 15px;
    }

    .security-select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--bg);
      color: var(--text);
    }

    .security-method {
      margin-top: 15px;
    }

    /* Estilos para el patrón */
    .pattern-container {
      display: flex;
      justify-content: center;
      margin: 15px 0;
    }

    .pattern-grid {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-template-rows: repeat(3, 60px);
      gap: 10px;
    }

    .pattern-dot {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--bg);
      border: 2px solid var(--border);
      cursor: pointer;
    }

    .pattern-dot.active {
      background-color: var(--primary);
    }

    /* Estilos para huella digital */
    .fingerprint-container {
      text-align: center;
      margin: 20px 0;
    }

    .fingerprint-icon {
      font-size: 60px;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .fingerprint-note {
      font-size: 0.8rem;
      color: var(--text);
      opacity: 0.7;
      margin-top: 10px;
   } 
 
  </style> 
 </head> 
 <body> <!-- Pantalla de Login --> 
  <div id="login"> 
   <div class="login-card animate__animated animate__fadeIn"> 
    <img src="https://sdmntprsouthcentralus.oaiusercontent.com/files/00000000-f9f8-61f7-ada1-a419a5964643/raw?se=2025-04-27T00%3A16%3A31Z&sp=r&sv=2024-08-04&sr=b&scid=c163b22a-ce53-57d5-ab6f-b6cbfe4656d7&skoid=7c382de0-129f-486b-9922-6e4a89c6eb7d&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2025-04-26T17%3A37%3A13Z&ske=2025-04-27T17%3A37%3A13Z&sks=b&skv=2024-08-04&sig=TyWXjByO/RGsZTis5iv9DeEbfcMKT11faA9i9TAv/8g%3D" alt="Diario Logo"> 
    <h2>Mi Diario Personal</h2> 
    <p>Ingresa tu PIN de 4 dígitos</p> 
    <div class="pin-display" id="pinDisplay"></div>
    <input type="password" id="passwordInput" class="pin-input" maxlength="4" autofocus>
    <div class="numeric-keypad compact">
      <button class="num-key compact" data-num="1">1</button>
      <button class="num-key compact" data-num="2">2</button>
      <button class="num-key compact" data-num="3">3</button>
      <button class="num-key compact" data-num="4">4</button>
      <button class="num-key compact" data-num="5">5</button>
      <button class="num-key compact" data-num="6">6</button>
      <button class="num-key compact" data-num="7">7</button>
      <button class="num-key compact" data-num="8">8</button>
      <button class="num-key compact" data-num="9">9</button>
      <button class="num-key compact" id="clear-pin"><i class="fa fa-arrow-left"></i></button>
      <button class="num-key compact" data-num="0">0</button>
      <button class="num-key compact" id="enter-pin"><i class="fa fa-unlock"></i></button>
    </div>
    <p id="login-error" style="color: #e74c3c; display: none;">PIN incorrecto</p>
    <p style="margin-top: 15px; font-size: 0.9em;">PIN de fábrica: 1234 (cámbialo en Configuración)</p>
   </div> 
  </div> <!-- Header con título y botón de modo --> 
  <header> <button class="mode-toggle" id="toggleMode"> <i class="fa fa-moon"></i> </button> 
   <h1><i class="fa fa-book"></i> Mi Diario Personal</h1> 
   <div class="header-date" id="currentDate"></div> 
  </header> <!-- Contenedor principal --> 
  <div class="container"> <!-- Sección Inicio --> 
   <section id="home" class="section active"> 
    <div class="card"> 
     <h2><i class="fa fa-home"></i> Bienvenido a tu diario</h2> 
     <div class="welcome-message"> 
      <p>Hola de nuevo. ¿Cómo te sientes hoy?</p> 
     </div> 
     <div class="mood-selector"> 
      <div class="mood" data-mood="😊">
       😊
      </div> 
      <div class="mood" data-mood="😐">
       😐
      </div> 
      <div class="mood" data-mood="😢">
       😢
      </div> 
      <div class="mood" data-mood="😡">
       😡
      </div> 
      <div class="mood" data-mood="😴">
       😴
      </div> 
      <div class="mood" data-mood="🥳">
       🥳
      </div> 
     </div> 
     <div class="stats"> 
      <div class="stat"> 
       <div class="stat-number" id="entriesCount">
        0
       </div> 
       <div class="stat-label">
        Entradas
       </div> 
      </div> 
      <div class="stat"> 
       <div class="stat-number" id="notesCount">
        0
       </div> 
       <div class="stat-label">
        Notas
       </div> 
      </div> 
      <div class="stat"> 
       <div class="stat-number" id="daysStreak">
        0
       </div> 
       <div class="stat-label">
        Días activo
       </div> 
      </div> 
     </div> 
     <h3>Últimas entradas</h3> 
     <div id="recent-entries"> <!-- Entradas recientes se cargarán aquí --> 
     </div> 
     <div style="text-align: center; margin-top: 20px;"> 
      <button class="btn" id="new-entry-btn"> <i class="fa fa-plus"></i> Nueva entrada </button> 
      <button class="btn btn-success" id="new-reminder-btn"> <i class="fa fa-bell"></i> Nuevo recordatorio </button>
     </div> 
    </div> 
   </section> <!-- Sección Entradas --> 
   <section id="entries" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-book-open"></i> Mis Entradas</h2> 
     <div class="search-bar"> 
      <input type="text" id="search-entries" placeholder="Buscar en mis entradas..."> <button class="btn" id="search-btn"><i class="fa fa-search"></i></button> 
     </div> 
     <div class="entries-list" id="entries-list"> <!-- Lista de entradas se cargará aquí --> 
     </div> 
    </div> 
    <div class="card" id="entry-editor"> 
     <h3><i class="fa fa-edit"></i> <span id="editor-title">Nueva entrada</span></h3> 
     <input type="date" id="entry-date"> 
     <input type="text" id="entry-title" placeholder="Título"> 
     <div class="mood-selector"> 
      <div class="mood" data-mood="😊">
       😊
      </div> 
      <div class="mood" data-mood="😐">
       😐
      </div> 
      <div class="mood" data-mood="😢">
       😢
      </div> 
      <div class="mood" data-mood="😡">
       😡
      </div> 
      <div class="mood" data-mood="😴">
       😴
      </div> 
      <div class="mood" data-mood="🥳">
       🥳
      </div> 
     </div> <textarea id="entry-content" rows="8" placeholder="¿Cómo fue tu día hoy?"></textarea> 
     <div style="text-align: right;"> <button class="btn btn-secondary" id="cancel-entry"><i class="fa fa-times"></i> Cancelar</button> <button class="btn" id="save-entry"><i class="fa fa-save"></i> Guardar</button> 
     </div> 
    </div> 
   </section> <!-- Sección Notas --> 
   <section id="notes" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-sticky-note"></i> Notas Rápidas</h2> 
     <p>Guarda tus ideas, pensamientos o recordatorios rápidos.</p> <button class="btn" id="add-note-btn"><i class="fa fa-plus"></i> Nueva nota</button> 
     <div class="quick-notes" id="notes-container"> <!-- Las notas se cargarán aquí --> 
     </div> 
    </div> 
   </section> <!-- Sección Dibujo --> 
   <section id="drawing" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-paint-brush"></i> Mi Lienzo</h2> 
     <p>Expresa tus emociones y pensamientos con dibujos.</p> 
     <div class="canvas-controls"> <button class="color-btn" style="background: #000000" data-color="#000000"></button> <button class="color-btn" style="background: #e74c3c" data-color="#e74c3c"></button> <button class="color-btn" style="background: #3498db" data-color="#3498db"></button> <button class="color-btn" style="background: #2ecc71" data-color="#2ecc71"></button> <button class="color-btn" style="background: #f1c40f" data-color="#f1c40f"></button> <button class="color-btn" style="background: #9b59b6" data-color="#9b59b6"></button> 
      <input type="range" id="brush-size" min="1" max="50" value="5"> 
      <button id="eraser-btn" onclick="toggleEraser()"><i class="fa fa-eraser"></i> Borrador</button>
      <button id="clear-canvas"><i class="fa fa-trash"></i> Limpiar</button> 
      <button id="save-drawing"><i class="fa fa-save"></i> Guardar</button>
      <button id="download-drawing"><i class="fa fa-download"></i> Descargar</button>
     </div> 
     <div id="canvas-container"> 
      <canvas id="drawing-canvas" width="800" height="400"></canvas> 
     </div> 
     <div id="saved-drawings"> <!-- Los dibujos guardados se mostrarán aquí --> 
     </div> 
    </div> 
   </section> <!-- Nueva Sección Hábitos --> 
   <section id="habits" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-check-circle"></i> Seguimiento de Hábitos</h2> 
     <p>Registra y sigue tus hábitos diarios.</p> 
     <div class="search-bar"> 
      <input type="text" id="new-habit-input" placeholder="Nuevo hábito (ej. Beber agua)"> 
      <button class="btn" id="add-habit-btn"><i class="fa fa-plus"></i> Añadir</button> 
     </div> 
     <div id="habits-list"> 
      <!-- Lista de hábitos se cargará aquí --> 
     </div> 
    </div> 
   </section> <!-- Nueva Sección Recordatorios --> 
   <section id="reminders" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-bell"></i> Mis Recordatorios</h2> 
     <p>Crea recordatorios para no olvidar cosas importantes.</p> 
     <div class="search-bar"> 
      <input type="text" id="new-reminder-input" placeholder="Nuevo recordatorio"> 
      <input type="datetime-local" id="reminder-time"> 
      <button class="btn" id="add-reminder-btn"><i class="fa fa-plus"></i> Añadir</button> 
     </div> 
     <div id="reminders-list"> 
      <!-- Lista de recordatorios se cargará aquí --> 
     </div> 
    </div> 
   </section> <!-- Nueva Sección Galería --> 
   <section id="gallery" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-images"></i> Mi Galería</h2> 
     <p>Guarda fotos y momentos especiales.</p> 
     <input type="file" id="photo-upload" accept="image/*" style="display: none;"> 
     <button class="btn" id="upload-photo-btn"><i class="fa fa-upload"></i> Subir foto</button> 
     <div class="photo-gallery" id="photo-gallery"> 
      <!-- Fotos se cargarán aquí --> 
     </div> 
    </div> 
   </section> <!-- Sección Configuración --> 
   <section id="settings" class="section"> 
    <div class="card"> 
     <h2><i class="fa fa-cog"></i> Configuración</h2> 
     <h3>Tema</h3> 
     <div class="themes"> 
      <div class="theme-option" style="background: linear-gradient(to right, #4e54c8, #8f94fb)" data-theme="default"></div> 
      <div class="theme-option" style="background: linear-gradient(to right, #11998e, #38ef7d)" data-theme="green"></div> 
      <div class="theme-option" style="background: linear-gradient(to right, #200122, #6f0000)" data-theme="red"></div> 
      <div class="theme-option" style="background: linear-gradient(to right, #c31432, #240b36)" data-theme="pink"></div> 
      <div class="theme-option" style="background: linear-gradient(to right, #2c3e50, #4ca1af)" data-theme="blue"></div> 
      <div class="theme-option" style="background: linear-gradient(to right, #f12711, #f5af19)" data-theme="orange"></div> 
     </div> 
     <h3>Modo</h3> <button class="btn" id="theme-toggle"><i class="fa fa-moon"></i> Cambiar a modo oscuro</button> 
     <h3>Seguridad</h3> 
     <div class="card"> 
      <h4>Configuración de Seguridad</h4>
      
      <!-- Selector de método de autenticación -->
      <div class="security-method-selector">
        <select id="security-method" class="security-select">
          <option value="pin">PIN numérico</option>
          <option value="pattern">Patrón</option>
          <option value="password">Contraseña de texto</option>
          <option value="fingerprint">Huella digital</option>
        </select>
      </div>
      
      <!-- Contenedores para cada método -->
      <div id="pin-settings" class="security-method">
        <div class="pin-display" id="changePinDisplay"></div>
        <input type="password" id="current-pin" class="pin-input" maxlength="4" placeholder="PIN actual">
        <input type="password" id="new-pin" class="pin-input" maxlength="4" placeholder="Nuevo PIN">
        <input type="password" id="confirm-pin" class="pin-input" maxlength="4" placeholder="Confirmar nuevo PIN">
        
        <!-- Teclado numérico compacto -->
        <div class="numeric-keypad compact">
          <button class="num-key compact" data-num="1">1</button>
          <button class="num-key compact" data-num="2">2</button>
          <button class="num-key compact" data-num="3">3</button>
          <button class="num-key compact" data-num="4">4</button>
          <button class="num-key compact" data-num="5">5</button>
          <button class="num-key compact" data-num="6">6</button>
          <button class="num-key compact" data-num="7">7</button>
          <button class="num-key compact" data-num="8">8</button>
          <button class="num-key compact" data-num="9">9</button>
          <button class="num-key compact" id="clear-change-pin"><i class="fa fa-arrow-left"></i></button>
          <button class="num-key compact" data-num="0">0</button>
          <button class="num-key compact" id="change-pin-btn"><i class="fa fa-key"></i> Cambiar</button>
        </div>
        <p id="pin-error" style="color: #e74c3c; display: none;"></p>
      </div>
      
      <div id="pattern-settings" class="security-method" style="display:none;">
        <p>Dibuja tu patrón de seguridad</p>
        <div class="pattern-container">
          <div class="pattern-grid">
            <div class="pattern-dot" data-cell="1"></div>
            <div class="pattern-dot" data-cell="2"></div>
            <div class="pattern-dot" data-cell="3"></div>
            <div class="pattern-dot" data-cell="4"></div>
            <div class="pattern-dot" data-cell="5"></div>
            <div class="pattern-dot" data-cell="6"></div>
            <div class="pattern-dot" data-cell="7"></div>
            <div class="pattern-dot" data-cell="8"></div>
            <div class="pattern-dot" data-cell="9"></div>
          </div>
        </div>
        <div class="pattern-actions">
          <button class="btn btn-secondary" id="reset-pattern">Reiniciar</button>
          <button class="btn" id="save-pattern">Guardar Patrón</button>
        </div>
      </div>
      
      <div id="password-settings" class="security-method" style="display:none;">
        <input type="password" id="current-password" placeholder="Contraseña actual">
        <input type="password" id="new-password" placeholder="Nueva contraseña">
        <input type="password" id="confirm-password" placeholder="Confirmar nueva contraseña">
        <button class="btn" id="change-password-btn"><i class="fa fa-key"></i> Cambiar Contraseña</button>
        <p id="password-error" style="color: #e74c3c; display: none;"></p>
      </div>
      
      <div id="fingerprint-settings" class="security-method" style="display:none;">
        <p>Configuración de huella digital</p>
        <div class="fingerprint-container">
          <i class="fa fa-fingerprint fingerprint-icon"></i>
          <p>Escanea tu huella digital para configurar</p>
        </div>
        <div class="fingerprint-actions">
          <button class="btn" id="enable-fingerprint"><i class="fa fa-plus"></i> Habilitar Huella</button>
          <button class="btn btn-danger" id="disable-fingerprint"><i class="fa fa-times"></i> Deshabilitar</button>
        </div>
        <p class="fingerprint-note">Nota: Puedes usar huella digital junto con PIN o patrón</p>
      </div>
     </div> 
     <h3>Datos</h3> 
     <div class="card"> 
      <h4>Respaldo y restauración</h4> <button class="btn" id="export-data"><i class="fa fa-download"></i> Exportar datos</button> <button class="btn btn-warning" id="import-data"><i class="fa fa-upload"></i> Importar datos</button> 
      <input type="file" id="import-file" style="display: none;"> <button class="btn btn-danger" id="delete-all-data"><i class="fa fa-trash"></i> Borrar todos los datos</button> 
     </div> 
     <div class="credits">
      Powered By Andres Alvarez<br> Versión 2.1.0
     </div>
    </div> 
   </section> 
  </div> <!-- Footer de navegación --> 
  <footer> 
    <i class="fa fa-home active-nav" data-section="home"></i> 
    <i class="fa fa-book-open" data-section="entries"></i> 
    <i class="fa fa-sticky-note" data-section="notes"></i> 
    <i class="fa fa-paint-brush" data-section="drawing"></i> 
    <i class="fa fa-check-circle" data-section="habits"></i>
    <i class="fa fa-bell" data-section="reminders"></i>
    <i class="fa fa-images" data-section="gallery"></i>
    <i class="fa fa-cog" data-section="settings"></i>
  </footer> <!-- Scripts --> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.12/sweetalert2.min.js"></script> 
  <script>
  // Configuración del PIN por defecto
  const DEFAULT_PIN = "1234";
  
  // Variables globales
  let currentTheme = "default";
  let isDarkMode = false;
  let currentMood = "";
  let currentEntryId = null;
  let drawingColor = "#000000";
  let brushSize = 5;
  let isDrawing = false;
  let isErasing = false;
  let canvas, ctx;
  let enteredPin = "";
  let patternCells = [];
  let isDrawingPattern = false;
  
  // Función para inicializar la aplicación
  function inicializarApp() {
    // Inicializar la fecha actual
    actualizarFechaActual();
    
    // Configurar el canvas de dibujo
    inicializarCanvas();
    
    // Cargar datos del localStorage
    cargarEstadisticas();
    cargarEntradasRecientes();
    cargarListaEntradas();
    cargarNotas();
    cargarHabitos();
    cargarRecordatorios();
    cargarFotos();
    
    // Establecer la sección activa por defecto
    mostrarSeccion('home');
    
    // Establecer el modo (claro/oscuro) según preferencias
    verificarModoOscuro();
    
    // Configurar la fecha de entrada por defecto como hoy
    document.getElementById('entry-date').valueAsDate = new Date();
    
    // Ocultar el editor de entradas por defecto
    $('#entry-editor').hide();
    
    // Configurar fecha/hora por defecto para recordatorios
    const now = new Date();
    now.setMinutes(now.getMinutes() + 30);
    document.getElementById('reminder-time').value = now.toISOString().slice(0, 16);
    
    // Configurar selector de métodos de seguridad
    $('#security-method').change(function() {
      const method = $(this).val();
      $('.security-method').hide();
      $(`#${method}-settings`).show();
    });
    
    // Inicialmente mostrar solo PIN
    $('#pin-settings').show();
  }
  
  // Función para mostrar la fecha actual
  function actualizarFechaActual() {
    const hoy = new Date();
    const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('currentDate').innerText = hoy.toLocaleDateString('es-ES', opciones);
  }
  
  // Función para inicializar el canvas de dibujo
  function inicializarCanvas() {
    canvas = document.getElementById('drawing-canvas');
    ctx = canvas.getContext('2d');
    
    // Ajustar el tamaño del canvas al contenedor
    function resizeCanvas() {
      const container = document.getElementById('canvas-container');
      const width = container.offsetWidth - 2; // -2 para el borde
      
      // Mantener la proporción pero no hacer el canvas más grande que su tamaño original
      const aspectRatio = canvas.height / canvas.width;
      const newWidth = Math.min(width, canvas.width);
      const newHeight = newWidth * aspectRatio;
      
      canvas.style.width = newWidth + 'px';
      canvas.style.height = newHeight + 'px';
    }
    
    // Ajustar el canvas al cargar y al cambiar el tamaño de la ventana
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // Eventos de dibujo
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // Eventos táctiles para dispositivos móviles
    canvas.addEventListener('touchstart', function(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousedown', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      canvas.dispatchEvent(mouseEvent);
    });
    
    canvas.addEventListener('touchmove', function(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent('mousemove', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      canvas.dispatchEvent(mouseEvent);
    });
    
    canvas.addEventListener('touchend', function(e) {
      e.preventDefault();
      const mouseEvent = new MouseEvent('mouseup');
      canvas.dispatchEvent(mouseEvent);
    });
    
    // Limpiar el canvas
    limpiarCanvas();
  }
  
  // Funciones para dibujar en el canvas
  function startDrawing(e) {
    isDrawing = true;
    draw(e);
  }
  
  function draw(e) {
    if (!isDrawing) return;
    
    // Obtener la posición del cursor relativa al canvas
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    // Calcular la posición real en el canvas
    const x = (e.clientX - rect.left) * scaleX;
    const y = (e.clientY - rect.top) * scaleY;
    
    if (isErasing) {
      // Modo borrador
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, brushSize, 0, Math.PI * 2);
      ctx.fill();
    } else {
      // Modo dibujo normal
      ctx.globalCompositeOperation = 'source-over';
      ctx.lineWidth = brushSize;
      ctx.lineCap = 'round';
      ctx.strokeStyle = drawingColor;
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
    }
  }
  
  function stopDrawing() {
    isDrawing = false;
    ctx.beginPath();
  }
  
  // Función para activar/desactivar el borrador
  function toggleEraser() {
    isErasing = !isErasing;
    if (isErasing) {
      $('#eraser-btn').addClass('active');
      mostrarMensaje('Modo borrador activado', 'info');
    } else {
      $('#eraser-btn').removeClass('active');
      mostrarMensaje('Modo borrador desactivado', 'info');
    }
  }
  
  // Función para descargar el dibujo actual
  function descargarDibujo() {
    const link = document.createElement('a');
    link.download = 'mi_dibujo_' + new Date().toISOString().slice(0, 10) + '.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  }
  
  // Función para cargar estadísticas
  function cargarEstadisticas() {
    const entries = obtenerEntradas();
    const notes = obtenerNotas();
    const streak = calcularRacha();
    
    $('#entriesCount').text(entries.length);
    $('#notesCount').text(notes.length);
    $('#daysStreak').text(streak);
  }
  
  // Función para calcular la racha de días
  function calcularRacha() {
    const entries = obtenerEntradas();
    if (entries.length === 0) return 0;
    
    // Ordenar entradas por fecha
    entries.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Verificar si hay entrada hoy
    const hoy = new Date().toISOString().split('T')[0];
    const tieneEntradaHoy = entries.some(entry => entry.date === hoy);
    
    // Si no hay entrada hoy, no hay racha
    if (!tieneEntradaHoy) return 0;
    
    // Calcular racha
    let racha = 1;
    let fechaAnterior = new Date(hoy);
    
    for (let i = 0; i < entries.length; i++) {
      const fechaEntrada = new Date(entries[i].date);
      const diferenciaDias = Math.floor((fechaAnterior - fechaEntrada) / (1000 * 60 * 60 * 24));
      
      if (diferenciaDias === 1) {
        racha++;
        fechaAnterior = fechaEntrada;
      } else if (diferenciaDias > 1) {
        break;
      }
    }
    
    return racha;
  }
  
  // Función para cargar entradas recientes
  function cargarEntradasRecientes() {
    const entries = obtenerEntradas();
    const recentEntries = $('#recent-entries');
    recentEntries.empty();
    
    // Ordenar entradas por fecha (más reciente primero)
    entries.sort((a, b) => new Date(b.date) - new Date(a.date));
    // Tomar solo las 3 entradas más recientes
    const recientes = entries.slice(0, 3);
    
    if (recientes.length === 0) {
      recentEntries.html('<p>No hay entradas recientes. ¡Crea tu primera entrada!</p>');
      return;
    }
    
    recientes.forEach(entry => {
      const preview = entry.content.length > 100 ? entry.content.substring(0, 100) + '...' : entry.content;
      const entryItem = $(`
        <div class="entry-item" data-id="${entry.id}">
          <div class="entry-date">${formatearFecha(entry.date)} ${entry.mood || ''}</div>
          <strong>${entry.title}</strong>
          <div class="entry-preview">${preview}</div>
        </div>
      `);
      
      entryItem.on('click', function() {
        // Editar esta entrada
        editarEntrada(entry.id);
        mostrarSeccion('entries');
      });
      
      recentEntries.append(entryItem);
    });
  }
  
  // Función para formatear una fecha
  function formatearFecha(fechaISO) {
    const fecha = new Date(fechaISO);
    return fecha.toLocaleDateString('es-ES', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
  }
  
  // Función para cargar la lista completa de entradas
  function cargarListaEntradas() {
    const entries = obtenerEntradas();
    const entriesList = $('#entries-list');
    entriesList.empty();
    
    // Ordenar entradas por fecha (más reciente primero)
    entries.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    if (entries.length === 0) {
      entriesList.html('<p>No hay entradas. ¡Crea tu primera entrada!</p>');
      return;
    }
    
    entries.forEach(entry => {
      const preview = entry.content.length > 100 ? entry.content.substring(0, 100) + '...' : entry.content;
      const entryItem = $(`
        <div class="entry-item" data-id="${entry.id}">
          <div class="entry-date">${formatearFecha(entry.date)} ${entry.mood || ''}</div>
          <strong>${entry.title}</strong>
          <div class="entry-preview">${preview}</div>
        </div>
      `);
      
      entryItem.on('click', function() {
        editarEntrada(entry.id);
      });
      
      entriesList.append(entryItem);
    });
  }
  
  // Función para cargar notas
  function cargarNotas() {
    const notes = obtenerNotas();
    const notesContainer = $('#notes-container');
    notesContainer.empty();
    
    // Si no hay notas, mostrar mensaje
    if (notes.length === 0) {
      notesContainer.html('<p>No hay notas. ¡Crea tu primera nota!</p>');
      return;
    }
    
    // Mostrar cada nota
    notes.forEach(note => {
      const noteElement = $(`
        <div class="note" data-id="${note.id}">
          <textarea>${note.content}</textarea>
          <div class="note-actions">
            <i class="fa fa-save" title="Guardar"></i>
            <i class="fa fa-trash" title="Eliminar"></i>
          </div>
        </div>
      `);
      
      // Evento para guardar la nota
      noteElement.find('.fa-save').on('click', function() {
        const content = noteElement.find('textarea').val();
        guardarNota(note.id, content);
        mostrarMensaje('Nota guardada', 'success');
      });
      
      // Evento para eliminar la nota
      noteElement.find('.fa-trash').on('click', function() {
        if (confirm('¿Eliminar esta nota?')) {
          eliminarNota(note.id);
          noteElement.remove();
          cargarEstadisticas();
        }
      });
      
      notesContainer.append(noteElement);
    });
  }
  
  // Función para cargar hábitos
  function cargarHabitos() {
    const habitos = obtenerHabitos();
    const habitsList = $('#habits-list');
    habitsList.empty();
    
    if (habitos.length === 0) {
      habitsList.html('<p>No hay hábitos registrados. ¡Añade tu primer hábito!</p>');
      return;
    }
    
    habitos.forEach(habit => {
      const habitElement = $(`
        <div class="card" style="margin-top: 15px;">
          <h3>${habit.name}</h3>
          <div class="habit-tracker">
            <div class="habit-day ${habit.days.includes(0) ? 'completed' : ''}" data-day="0">L</div>
            <div class="habit-day ${habit.days.includes(1) ? 'completed' : ''}" data-day="1">M</div>
            <div class="habit-day ${habit.days.includes(2) ? 'completed' : ''}" data-day="2">M</div>
            <div class="habit-day ${habit.days.includes(3) ? 'completed' : ''}" data-day="3">J</div>
            <div class="habit-day ${habit.days.includes(4) ? 'completed' : ''}" data-day="4">V</div>
            <div class="habit-day ${habit.days.includes(5) ? 'completed' : ''}" data-day="5">S</div>
            <div class="habit-day ${habit.days.includes(6) ? 'completed' : ''}" data-day="6">D</div>
          </div>
          <div style="text-align: right; margin-top: 10px;">
            <button class="btn btn-danger delete-habit" data-id="${habit.id}">
              <i class="fa fa-trash"></i> Eliminar
            </button>
          </div>
        </div>
      `);
      
      // Evento para marcar día como completado
      habitElement.find('.habit-day').click(function() {
        const day = parseInt($(this).data('day'));
        toggleDiaHabit(habit.id, day);
        $(this).toggleClass('completed');
      });
      
      // Evento para eliminar hábito
      habitElement.find('.delete-habit').click(function() {
        if (confirm('¿Eliminar este hábito?')) {
          eliminarHabito(habit.id);
          habitElement.remove();
        }
      });
      
      habitsList.append(habitElement);
    });
  }
  
  // Función para cargar recordatorios
  function cargarRecordatorios() {
    const recordatorios = obtenerRecordatorios();
    const remindersList = $('#reminders-list');
    remindersList.empty();
    
    if (recordatorios.length === 0) {
      remindersList.html('<p>No hay recordatorios. ¡Añade tu primer recordatorio!</p>');
      return;
    }
    
    // Ordenar recordatorios por fecha
    recordatorios.sort((a, b) => new Date(a.time) - new Date(b.time));
    
    recordatorios.forEach(reminder => {
      const reminderElement = $(`
        <div class="reminder-item" data-id="${reminder.id}">
          <div class="reminder-text">
            <strong>${reminder.text}</strong>
            <div>${new Date(reminder.time).toLocaleString()}</div>
          </div>
          <div class="reminder-actions">
            <i class="fa fa-check complete-reminder" title="Completar"></i>
            <i class="fa fa-trash delete-reminder" title="Eliminar"></i>
          </div>
        </div>
      `);
      
      // Evento para marcar como completado
      reminderElement.find('.complete-reminder').click(function() {
        completarRecordatorio(reminder.id);
        reminderElement.remove();
      });
      
      // Evento para eliminar recordatorio
      reminderElement.find('.delete-reminder').click(function() {
        if (confirm('¿Eliminar este recordatorio?')) {
          eliminarRecordatorio(reminder.id);
          reminderElement.remove();
        }
      });
      
      remindersList.append(reminderElement);
    });
  }
  
  // Función para cargar fotos
  function cargarFotos() {
    const fotos = obtenerFotos();
    const photoGallery = $('#photo-gallery');
    photoGallery.empty();
    
    if (fotos.length === 0) {
      photoGallery.html('<p>No hay fotos en la galería. ¡Sube tu primera foto!</p>');
      return;
    }
    
    fotos.forEach(photo => {
      const photoElement = $(`
        <div class="photo-item" data-id="${photo.id}">
          <img src="${photo.dataURL}" alt="${photo.title || 'Foto'}">
          <div class="photo-actions">
            <i class="fa fa-download download-photo" title="Descargar"></i>
            <i class="fa fa-trash delete-photo" title="Eliminar"></i>
          </div>
        </div>
      `);
      
      // Evento para descargar foto
      photoElement.find('.download-photo').click(function() {
        descargarImagen(photo.dataURL, photo.title || 'foto');
      });
      
      // Evento para eliminar foto
      photoElement.find('.delete-photo').click(function() {
        if (confirm('¿Eliminar esta foto?')) {
          eliminarFoto(photo.id);
          photoElement.remove();
        }
      });
      
      photoGallery.append(photoElement);
    });
  }
  
  // Función para guardar un dibujo
  function guardarDibujo() {
    const dataURL = canvas.toDataURL('image/png');
    
    Swal.fire({
        title: 'Guardar dibujo',
        input: 'text',
        inputLabel: 'Título del dibujo',
        inputPlaceholder: 'Ingresa un título para tu dibujo',
        showCancelButton: true,
        confirmButtonText: 'Guardar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            const title = result.value || 'Dibujo sin título';
            
            const dibujos = JSON.parse(localStorage.getItem('diario_dibujos') || '[]');
            dibujos.push({
                id: 'drawing_' + Date.now(),
                title: title,
                dataURL: dataURL,
                createdAt: new Date().toISOString()
            });
            
            localStorage.setItem('diario_dibujos', JSON.stringify(dibujos));
            mostrarMensaje('Dibujo guardado', 'success');
            limpiarCanvas();
            
            mostrarDibujosGuardados();
        }
    });
  }

  function mostrarDibujosGuardados() {
    const dibujos = JSON.parse(localStorage.getItem('diario_dibujos') || '[]');
    const container = $('#saved-drawings');
    container.empty();
    
    if (dibujos.length === 0) {
        container.html('<p>No hay dibujos guardados.</p>');
        return;
    }
    
    dibujos.forEach(dibujo => {
        const dibujoElement = $(`
            <div class="card" style="margin-top: 20px;">
                <h3>${dibujo.title}</h3>
                <p>Guardado el ${new Date(dibujo.createdAt).toLocaleDateString()}</p>
                <img src="${dibujo.dataURL}" style="max-width: 100%; border: 1px solid var(--border); border-radius: 8px;">
                <div style="margin-top: 10px;">
                    <button class="btn btn-secondary edit-drawing" data-id="${dibujo.id}" style="margin-right: 5px;">
                        <i class="fa fa-edit"></i> Editar
                    </button>
                    <button class="btn btn-danger delete-drawing" data-id="${dibujo.id}">
                        <i class="fa fa-trash"></i> Eliminar
                    </button>
                    <button class="btn download-drawing" data-url="${dibujo.dataURL}" data-title="${dibujo.title}">
                        <i class="fa fa-download"></i> Descargar
                    </button>
                </div>
            </div>
        `);
        
        container.append(dibujoElement);
    });
    
    $('.edit-drawing').click(function() {
        const id = $(this).data('id');
        editarDibujo(id);
    });
    
    $('.delete-drawing').click(function() {
        const id = $(this).data('id');
        eliminarDibujo(id);
    });
    
    $('.download-drawing').click(function() {
        const url = $(this).data('url');
        const title = $(this).data('title') || 'dibujo';
        descargarImagen(url, title);
    });
  }
  
  // Función para descargar una imagen
  function descargarImagen(url, nombre) {
    const link = document.createElement('a');
    link.download = nombre + '.png';
    link.href = url;
    link.click();
  }
  
  // Función para editar un dibujo existente
  function editarDibujo(id) {
    const dibujos = JSON.parse(localStorage.getItem('diario_dibujos') || []);
    const dibujo = dibujos.find(d => d.id === id);
    
    if (dibujo) {
      // Cargar la imagen en el canvas
      const img = new Image();
      img.onload = function() {
        limpiarCanvas();
        ctx.drawImage(img, 0, 0);
      };
      img.src = dibujo.dataURL;
      
      mostrarMensaje('Dibujo cargado para edición', 'success');
    }
  }
  
  // Función para eliminar un dibujo
  function eliminarDibujo(id) {
    Swal.fire({
      title: '¿Eliminar este dibujo?',
      text: 'Esta acción no se puede deshacer',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Sí, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        let dibujos = JSON.parse(localStorage.getItem('diario_dibujos') || []);
        dibujos = dibujos.filter(d => d.id !== id);
        localStorage.setItem('diario_dibujos', JSON.stringify(dibujos));
        mostrarDibujosGuardados();
        mostrarMensaje('Dibujo eliminado', 'success');
      }
    });
  }
  
  // Función para limpiar el canvas
  function limpiarCanvas() {
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = drawingColor;
  }
  
  // Funciones para obtener datos del localStorage
  function obtenerEntradas() {
    return JSON.parse(localStorage.getItem('diario_entradas') || '[]');
  }
  
  function obtenerNotas() {
    return JSON.parse(localStorage.getItem('diario_notas') || '[]');
  }
  
  function obtenerHabitos() {
    return JSON.parse(localStorage.getItem('diario_habitos') || '[]');
  }
  
  function obtenerRecordatorios() {
    return JSON.parse(localStorage.getItem('diario_recordatorios') || '[]');
  }
  
  function obtenerFotos() {
    return JSON.parse(localStorage.getItem('diario_fotos') || '[]');
  }
  
  // Función para mostrar una sección específica
  function mostrarSeccion(seccionId) {
    // Ocultar todas las secciones
    $('.section').removeClass('active');
    
    // Mostrar la sección seleccionada
    $(`#${seccionId}`).addClass('active');
    
    // Actualizar navegación
    $('footer i').removeClass('active-nav');
    $(`.fa-${mapIconToSection(seccionId)}`).addClass('active-nav');
    
    // Lógica específica según la sección
    if (seccionId === 'entries') {
      cargarListaEntradas();
    } else if (seccionId === 'notes') {
      cargarNotas();
    } else if (seccionId === 'drawing') {
      mostrarDibujosGuardados();
    } else if (seccionId === 'habits') {
      cargarHabitos();
    } else if (seccionId === 'reminders') {
      cargarRecordatorios();
    } else if (seccionId === 'gallery') {
      cargarFotos();
    }
  }
  
  // Mapear sección a icono
  function mapIconToSection(seccionId) {
    const iconMap = {
      'home': 'home',
      'entries': 'book-open',
      'notes': 'sticky-note',
      'drawing': 'paint-brush',
      'habits': 'check-circle',
      'reminders': 'bell',
      'gallery': 'images',
      'settings': 'cog'
    };
    return iconMap[seccionId];
  }
  
  // Función para verificar el modo oscuro
  function verificarModoOscuro() {
    // Verificar preferencias guardadas
    isDarkMode = localStorage.getItem('diario_darkmode') === 'true';
    
    // Aplicar modo oscuro si es necesario
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
      $('#toggleMode i').removeClass('fa-moon').addClass('fa-sun');
      $('#theme-toggle').html('<i class="fa fa-sun"></i> Cambiar a modo claro');
    }
  }
  
  // Función para cambiar el modo oscuro/claro
  function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    
    // Guardar preferencia
    localStorage.setItem('diario_darkmode', isDarkMode);
    
    // Aplicar cambios
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
      $('#toggleMode i').removeClass('fa-sun').addClass('fa-moon');
      $('#theme-toggle').html('<i class="fa fa-sun"></i> Cambiar a modo claro');
    } else {
      document.body.classList.remove('dark-mode');
      $('#toggleMode i').removeClass('fa-sun').addClass('fa-moon');
      $('#theme-toggle').html('<i class="fa fa-moon"></i> Cambiar a modo oscuro');
    }
  }
  
  // Función para crear una nueva entrada
  function nuevaEntrada() {
    currentEntryId = null;
    $('#editor-title').text('Nueva entrada');
    $('#entry-date').valueAsDate = new Date();
    $('#entry-title').val('');
    $('#entry-content').val('');
    currentMood = '';
    $('.mood').removeClass('selected-mood');
    $('#entry-editor').show();
  }
  
  // Función para editar una entrada existente
  function editarEntrada(entryId) {
    const entries = obtenerEntradas();
    const entry = entries.find(e => e.id === entryId);
    
    if (entry) {
      currentEntryId = entryId;
      $('#editor-title').text('Editar entrada');
      $('#entry-date').val(entry.date);
      $('#entry-title').val(entry.title);
      $('#entry-content').val(entry.content);
      
      // Seleccionar el estado de ánimo si existe
      currentMood = entry.mood || '';
      $('.mood').removeClass('selected-mood');
      if (currentMood) {
        $(`.mood[data-mood="${currentMood}"]`).addClass('selected-mood');
      }
      
      $('#entry-editor').show();
    }
  }
  
  // Función para guardar una entrada
  function guardarEntrada() {
    const date = $('#entry-date').val();
    const title = $('#entry-title').val() || 'Sin título';
    const content = $('#entry-content').val();
    
    if (!content) {
      mostrarMensaje('Por favor escribe algo en tu entrada', 'error');
      return;
    }
    
    const entries = obtenerEntradas();
    
    if (currentEntryId) {
      // Actualizar entrada existente
      const index = entries.findIndex(e => e.id === currentEntryId);
      if (index !== -1) {
        entries[index] = {
          ...entries[index],
          date: date,
          title: title,
          content: content,
          mood: currentMood,
          updatedAt: new Date().toISOString()
        };
      }
    } else {
      // Crear nueva entrada
      const newEntry = {
        id: 'entry_' + Date.now(),
        date: date,
        title: title,
        content: content,
        mood: currentMood,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      entries.push(newEntry);
    }
    
    // Guardar en localStorage
    localStorage.setItem('diario_entradas', JSON.stringify(entries));
    
    // Actualizar vistas
    cargarEntradasRecientes();
    cargarListaEntradas();
    cargarEstadisticas();
    
    // Ocultar editor
    $('#entry-editor').hide();
    
    // Mostrar mensaje de éxito
    mostrarMensaje('Entrada guardada con éxito', 'success');
  }
  
  // Función para cancelar la edición
  function cancelarEdicion() {
    if (confirm('¿Cancelar los cambios?')) {
      $('#entry-editor').hide();
    }
  }
  
  // Función para agregar una nueva nota
  function agregarNota() {
    const notas = obtenerNotas();
    
    const nuevaNota = {
      id: 'note_' + Date.now(),
      content: '',
      createdAt: new Date().toISOString()
    };
    
    notas.push(nuevaNota);
    localStorage.setItem('diario_notas', JSON.stringify(notas));
    
    cargarNotas();
    cargarEstadisticas();
  }
  
  // Función para guardar una nota
  function guardarNota(noteId, content) {
    const notas = obtenerNotas();
    const index = notas.findIndex(n => n.id === noteId);
    
    if (index !== -1) {
      notas[index].content = content;
      notas[index].updatedAt = new Date().toISOString();
      
      localStorage.setItem('diario_notas', JSON.stringify(notas));
    }
  }
  
  // Función para eliminar una nota
  function eliminarNota(noteId) {
    let notas = obtenerNotas();
    notas = notas.filter(n => n.id !== noteId);
    
    localStorage.setItem('diario_notas', JSON.stringify(notas));
    cargarEstadisticas();
  }
  
  // Función para agregar un nuevo hábito
  function agregarHabito() {
    const nombre = $('#new-habit-input').val().trim();
    if (!nombre) {
      mostrarMensaje('Por favor ingresa un nombre para el hábito', 'error');
      return;
    }
    
    const habitos = obtenerHabitos();
    
    const nuevoHabito = {
      id: 'habit_' + Date.now(),
      name: nombre,
      days: [],
      createdAt: new Date().toISOString()
    };
    
    habitos.push(nuevoHabito);
    localStorage.setItem('diario_habitos', JSON.stringify(habitos));
    
    $('#new-habit-input').val('');
    cargarHabitos();
    mostrarMensaje('Hábito añadido', 'success');
  }
  
  // Función para alternar un día de hábito
  function toggleDiaHabit(habitId, day) {
    const habitos = obtenerHabitos();
    const index = habitos.findIndex(h => h.id === habitId);
    
    if (index !== -1) {
      const dayIndex = habitos[index].days.indexOf(day);
      if (dayIndex === -1) {
        habitos[index].days.push(day);
      } else {
        habitos[index].days.splice(dayIndex, 1);
      }
      
      localStorage.setItem('diario_habitos', JSON.stringify(habitos));
    }
  }
  
  // Función para eliminar un hábito
  function eliminarHabito(habitId) {
    let habitos = obtenerHabitos();
    habitos = habitos.filter(h => h.id !== habitId);
    
    localStorage.setItem('diario_habitos', JSON.stringify(habitos));
    mostrarMensaje('Hábito eliminado', 'success');
  }
  
  // Función para agregar un nuevo recordatorio
  function agregarRecordatorio() {
    const texto = $('#new-reminder-input').val().trim();
    const tiempo = $('#reminder-time').val();
    
    if (!texto) {
      mostrarMensaje('Por favor ingresa un texto para el recordatorio', 'error');
      return;
    }
    
    const recordatorios = obtenerRecordatorios();
    
    const nuevoRecordatorio = {
      id: 'reminder_' + Date.now(),
      text: texto,
      time: tiempo,
      createdAt: new Date().toISOString()
    };
    
    recordatorios.push(nuevoRecordatorio);
    localStorage.setItem('diario_recordatorios', JSON.stringify(recordatorios));
    
    $('#new-reminder-input').val('');
    // Configurar fecha/hora por defecto para el próximo recordatorio
    const now = new Date();
    now.setMinutes(now.getMinutes() + 30);
    document.getElementById('reminder-time').value = now.toISOString().slice(0, 16);
    
    cargarRecordatorios();
    mostrarMensaje('Recordatorio añadido', 'success');
  }
  
  // Función para completar un recordatorio
  function completarRecordatorio(reminderId) {
    let recordatorios = obtenerRecordatorios();
    recordatorios = recordatorios.filter(r => r.id !== reminderId);
    
    localStorage.setItem('diario_recordatorios', JSON.stringify(recordatorios));
    mostrarMensaje('Recordatorio completado', 'success');
  }
  
  // Función para eliminar un recordatorio
  function eliminarRecordatorio(reminderId) {
    let recordatorios = obtenerRecordatorios();
    recordatorios = recordatorios.filter(r => r.id !== reminderId);
    
    localStorage.setItem('diario_recordatorios', JSON.stringify(recordatorios));
    mostrarMensaje('Recordatorio eliminado', 'success');
  }
  
  // Función para subir una foto
  function subirFoto() {
    const fileInput = document.getElementById('photo-upload');
    fileInput.click();
    
    fileInput.onchange = function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      if (!file.type.match('image.*')) {
        mostrarMensaje('Por favor selecciona un archivo de imagen', 'error');
        return;
      }
      
      Swal.fire({
        title: 'Subir foto',
        input: 'text',
        inputLabel: 'Título de la foto (opcional)',
        inputPlaceholder: 'Ingresa un título para tu foto',
        showCancelButton: true,
        confirmButtonText: 'Subir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          const title = result.value || '';
          
          const reader = new FileReader();
          reader.onload = function(e) {
            const fotos = obtenerFotos();
            
            fotos.push({
              id: 'photo_' + Date.now(),
              title: title,
              dataURL: e.target.result,
              createdAt: new Date().toISOString()
            });
            
            localStorage.setItem('diario_fotos', JSON.stringify(fotos));
            cargarFotos();
            mostrarMensaje('Foto subida con éxito', 'success');
          };
          reader.readAsDataURL(file);
        }
      });
    };
  }
  
  // Función para eliminar una foto
  function eliminarFoto(photoId) {
    let fotos = obtenerFotos();
    fotos = fotos.filter(f => f.id !== photoId);
    
    localStorage.setItem('diario_fotos', JSON.stringify(fotos));
    mostrarMensaje('Foto eliminada', 'success');
  }
  
  // Función para verificar el PIN guardado o usar el por defecto
  function obtenerPin() {
    return localStorage.getItem('diario_pin') || DEFAULT_PIN;
  }
  
  // Función para cambiar el PIN
  function cambiarPin() {
    const currentPin = $('#current-pin').val();
    const newPin = $('#new-pin').val();
    const confirmPin = $('#confirm-pin').val();
    
    // Verificar PIN actual
    if (currentPin !== obtenerPin()) {
      $('#pin-error').text('El PIN actual es incorrecto').show();
      return;
    }
    
    // Verificar que los nuevos PIN coincidan
    if (newPin !== confirmPin) {
      $('#pin-error').text('Los nuevos PIN no coinciden').show();
      return;
    }
    
    // Verificar que el nuevo PIN tenga 4 dígitos
    if (newPin.length !== 4 || !/^\d+$/.test(newPin)) {
      $('#pin-error').text('El PIN debe tener exactamente 4 dígitos').show();
      return;
    }
    
    // Guardar el nuevo PIN
    localStorage.setItem('diario_pin', newPin);
    
    // Limpiar campos y mostrar mensaje
    $('#current-pin').val('');
    $('#new-pin').val('');
    $('#confirm-pin').val('');
    $('#pin-error').hide();
    mostrarMensaje('PIN cambiado con éxito', 'success');
  }
  
  // Función para actualizar la visualización del PIN
  function actualizarPinDisplay() {
    const display = $('#pinDisplay');
    display.empty();
    
    for (let i = 0; i < enteredPin.length; i++) {
      display.append('<span class="pin-dot"></span>');
    }
  }
  
  // Función para actualizar la visualización del PIN en configuración
  function actualizarChangePinDisplay() {
    const display = $('#changePinDisplay');
    display.empty();
    
    const currentPin = $('#current-pin').val();
    const newPin = $('#new-pin').val();
    const confirmPin = $('#confirm-pin').val();
    
    if (currentPin) {
      display.append('<div>PIN actual: ' + '•'.repeat(currentPin.length) + '</div>');
    }
    
    if (newPin) {
      display.append('<div>Nuevo PIN: ' + '•'.repeat(newPin.length) + '</div>');
    }
    
    if (confirmPin) {
      display.append('<div>Confirmar PIN: ' + '•'.repeat(confirmPin.length) + '</div>');
    }
  }
  
  // Función para exportar todos los datos
  function exportarDatos() {
    const datos = {
      entries: obtenerEntradas(),
      notes: obtenerNotas(),
      drawings: JSON.parse(localStorage.getItem('diario_dibujos') || '[]'),
      habits: obtenerHabitos(),
      reminders: obtenerRecordatorios(),
      photos: obtenerFotos(),
      settings: {
        darkMode: isDarkMode,
        theme: currentTheme
      },
      version: '1.0'
    };
    
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(datos));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "mi_diario_backup_" + new Date().toISOString().slice(0,10) + ".json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
    
    mostrarMensaje('Datos exportados correctamente', 'success');
  }
  
  // Función para importar datos
  function importarDatos() {
    const fileInput = document.getElementById('import-file');
    fileInput.click();
    
    fileInput.onchange = function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Verificar formato
          if (!data.entries || !data.notes) {
            throw new Error('Formato no válido');
          }
          
          // Confirmar antes de sobrescribir
          Swal.fire({
            title: '¿Importar datos?',
            text: 'Esto reemplazará tus datos actuales. ¿Continuar?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Sí, importar',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {
              // Guardar los datos
              localStorage.setItem('diario_entradas', JSON.stringify(data.entries));
              localStorage.setItem('diario_notas', JSON.stringify(data.notes));
              
              // Guardar dibujos si existen
              if (data.drawings) {
                localStorage.setItem('diario_dibujos', JSON.stringify(data.drawings));
              }
              
              // Guardar hábitos si existen
              if (data.habits) {
                localStorage.setItem('diario_habitos', JSON.stringify(data.habits));
              }
              
              // Guardar recordatorios si existen
              if (data.reminders) {
                localStorage.setItem('diario_recordatorios', JSON.stringify(data.reminders));
              }
              
              // Guardar fotos si existen
              if (data.photos) {
                localStorage.setItem('diario_fotos', JSON.stringify(data.photos));
              }
              
              // Aplicar configuraciones si existen
              if (data.settings) {
                if (data.settings.darkMode !== undefined) {
                  localStorage.setItem('diario_darkmode', data.settings.darkMode);
                  isDarkMode = data.settings.darkMode;
                  document.body.classList.toggle('dark-mode', isDarkMode);
                }
                
                if (data.settings.theme) {
                  currentTheme = data.settings.theme;
                  // Aplicar tema
                }
              }
              
              // Actualizar vistas
              cargarEntradasRecientes();
              cargarListaEntradas();
              cargarNotas();
              mostrarDibujosGuardados();
              cargarHabitos();
              cargarRecordatorios();
              cargarFotos();
              cargarEstadisticas();
              
              mostrarMensaje('Datos importados correctamente', 'success');
            }
          });
          
        } catch (error) {
          mostrarMensaje('Error al importar: archivo no válido', 'error');
        }
      };
      reader.readAsText(file);
    };
  }
  
  // Función para eliminar todos los datos
  function eliminarTodosDatos() {
    Swal.fire({
      title: '¿Eliminar todos los datos?',
      text: 'Esta acción no se puede deshacer',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Sí, eliminar todo',
      cancelButtonText: 'Cancelar',
      confirmButtonColor: '#d33'
    }).then((result) => {
      if (result.isConfirmed) {
        // Preservar solo el PIN
        const pin = obtenerPin();
        const darkMode = isDarkMode;
        
        // Eliminar datos
        localStorage.removeItem('diario_entradas');
        localStorage.removeItem('diario_notas');
        localStorage.removeItem('diario_dibujos');
        localStorage.removeItem('diario_habitos');
        localStorage.removeItem('diario_recordatorios');
        localStorage.removeItem('diario_fotos');
        
        // Restaurar PIN
        localStorage.setItem('diario_pin', pin);
        localStorage.setItem('diario_darkmode', darkMode);
        
        // Actualizar vistas
        cargarEntradasRecientes();
        cargarListaEntradas();
        cargarNotas();
        mostrarDibujosGuardados();
        cargarHabitos();
        cargarRecordatorios();
        cargarFotos();
        cargarEstadisticas();
        
        mostrarMensaje('Todos los datos han sido eliminados', 'success');
      }
    });
  }
  
  // Función para mostrar mensajes con SweetAlert2
  function mostrarMensaje(mensaje, tipo) {
    const Toast = Swal.mixin({
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true
    });
    
    Toast.fire({
      icon: tipo,
      title: mensaje
    });
  }
  
  // -------------------- EVENT LISTENERS --------------------
  
  // Eventos para el teclado numérico del login
  $('.num-key[data-num]').click(function() {
    if (enteredPin.length < 4) {
      enteredPin += $(this).data('num');
      actualizarPinDisplay();
    }
  });
  
  $('#clear-pin').click(function() {
    enteredPin = '';
    actualizarPinDisplay();
  });
  
  $('#enter-pin').click(function() {
    if (enteredPin === obtenerPin()) {
      $('#login').fadeOut();
      inicializarApp();
    } else {
      $('#login-error').show();
      enteredPin = '';
      actualizarPinDisplay();
    }
  });
  
  // Eventos para el teclado numérico en configuración
  $('.num-key[data-num]').click(function() {
    // Verificar si estamos en la sección de configuración
    if ($('#settings').hasClass('active')) {
      const activeInput = $('.pin-input:focus');
      if (activeInput.length && activeInput.val().length < 4) {
        activeInput.val(activeInput.val() + $(this).data('num'));
        actualizarChangePinDisplay();
      }
    }
  });
  
  $('#clear-change-pin').click(function() {
    const activeInput = $('.pin-input:focus');
    if (activeInput.length) {
      activeInput.val('');
      actualizarChangePinDisplay();
    }
  });
  
  $('#change-pin-btn').click(cambiarPin);
  
  // Evento para tecla Enter en el login
  $('#passwordInput').keypress(function(e) {
    if (e.which === 13) {
      $('#enter-pin').click();
    }
  });
  
  // Eventos de navegación del footer
  $('footer i').click(function() {
    const seccion = $(this).data('section');
    mostrarSeccion(seccion);
  });
  
  // Evento para cambiar modo oscuro/claro
  $('#toggleMode, #theme-toggle').click(function() {
    toggleDarkMode();
  });
  
  // Eventos para opciones de tema
  $('.theme-option').click(function() {
    currentTheme = $(this).data('theme');
    $('.theme-option').removeClass('active');
    $(this).addClass('active');
    // Aquí aplicaríamos el tema seleccionado
  });
  
  // Evento para crear nueva entrada desde home
  $('#new-entry-btn').click(function() {
    nuevaEntrada();
    mostrarSeccion('entries');
  });
  
  // Evento para crear nuevo recordatorio desde home
  $('#new-reminder-btn').click(function() {
    mostrarSeccion('reminders');
    $('#new-reminder-input').focus();
  });
  
  // Eventos para el editor de entradas
  $('#save-entry').click(guardarEntrada);
  $('#cancel-entry').click(cancelarEdicion);
  
  // Evento para seleccionar estado de ánimo
  $('.mood').click(function() {
    $('.mood').removeClass('selected-mood');
    $(this).addClass('selected-mood');
    currentMood = $(this).data('mood');
  });
  
  // Evento para agregar nueva nota
  $('#add-note-btn').click(agregarNota);
  
  // Evento para agregar nuevo hábito
  $('#add-habit-btn').click(agregarHabito);
  
  // Evento para agregar nuevo recordatorio
  $('#add-reminder-btn').click(agregarRecordatorio);
  
  // Evento para subir foto
  $('#upload-photo-btn').click(subirFoto);
  
  // Eventos para gestión de datos
  $('#export-data').click(exportarDatos);
  $('#import-data').click(importarDatos);
  $('#delete-all-data').click(eliminarTodosDatos);
  
  // Eventos para canvas
  $('.color-btn').click(function() {
    drawingColor = $(this).data('color');
    isErasing = false;
    $('#eraser-btn').removeClass('active');
  });
  
  $('#brush-size').on('input', function() {
    brushSize = $(this).val();
  });
  
  $('#clear-canvas').click(limpiarCanvas);
  $('#save-drawing').click(guardarDibujo);
  $('#download-drawing').click(descargarDibujo);
  
  // Evento para buscar entradas
  $('#search-btn').click(function() {
    const searchTerm = $('#search-entries').val().toLowerCase();
    const entries = obtenerEntradas();
    const entriesList = $('#entries-list');
    entriesList.empty();
    
    // Filtrar entradas
    const filtradas = entries.filter(entry => 
      entry.title.toLowerCase().includes(searchTerm) || 
      entry.content.toLowerCase().includes(searchTerm)
    );
    
    if (filtradas.length === 0) {
      entriesList.html('<p>No se encontraron entradas que coincidan con tu búsqueda.</p>');
      return;
    }
    
    // Mostrar resultados
    filtradas.forEach(entry => {
      const preview = entry.content.length > 100 ? entry.content.substring(0, 100) + '...' : entry.content;
      const entryItem = $(`
        <div class="entry-item" data-id="${entry.id}">
          <div class="entry-date">${formatearFecha(entry.date)} ${entry.mood || ''}</div>
          <strong>${entry.title}</strong>
          <div class="entry-preview">${preview}</div>
        </div>
      `);
      
      entryItem.on('click', function() {
        editarEntrada(entry.id);
      });
      
      entriesList.append(entryItem);
    });
  });
  
  // Eventos para el patrón de seguridad
  $('.pattern-dot').on('mousedown touchstart', function() {
    isDrawingPattern = true;
    patternCells = [];
    $('.pattern-dot').removeClass('active');
    addPatternCell($(this).data('cell'));
  });

  $('.pattern-dot').on('mouseenter touchmove', function(e) {
    if (isDrawingPattern) {
      addPatternCell($(this).data('cell'));
    }
  });

  $(document).on('mouseup touchend', function() {
    isDrawingPattern = false;
  });

  function addPatternCell(cell) {
    if (!patternCells.includes(cell)) {
      patternCells.push(cell);
      $(`.pattern-dot[data-cell="${cell}"]`).addClass('active');
    }
  }

  $('#save-pattern').click(function() {
    if (patternCells.length < 4) {
      mostrarMensaje('El patrón debe tener al menos 4 puntos', 'error');
      return;
    }
    
    localStorage.setItem('diario_pattern', JSON.stringify(patternCells));
    mostrarMensaje('Patrón guardado con éxito', 'success');
    patternCells = [];
  });

  $('#reset-pattern').click(function() {
    patternCells = [];
    $('.pattern-dot').removeClass('active');
  });
  
  // Evento para cambiar contraseña de texto
  $('#change-password-btn').click(function() {
    const currentPass = $('#current-password').val();
    const newPass = $('#new-password').val();
    const confirmPass = $('#confirm-password').val();
    
    // Validaciones
    if (!currentPass || !newPass || !confirmPass) {
      $('#password-error').text('Todos los campos son requeridos').show();
      return;
    }
    
    if (newPass !== confirmPass) {
      $('#password-error').text('Las contraseñas no coinciden').show();
      return;
    }
    
    if (newPass.length < 6) {
      $('#password-error').text('La contraseña debe tener al menos 6 caracteres').show();
      return;
    }
    
    // Guardar la nueva contraseña
    localStorage.setItem('diario_password', newPass);
    $('#password-error').hide();
    mostrarMensaje('Contraseña cambiada con éxito', 'success');
    
    // Limpiar campos
    $('#current-password').val('');
    $('#new-password').val('');
    $('#confirm-password').val('');
  });
  
  // Simulación de huella digital
  $('#enable-fingerprint').click(function() {
    Swal.fire({
      title: 'Configurar Huella Digital',
      text: 'Por favor, escanea tu huella en el sensor',
      icon: 'info',
      showCancelButton: true,
      confirmButtonText: 'Configurar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        localStorage.setItem('diario_fingerprint', 'enabled');
        mostrarMensaje('Huella digital configurada', 'success');
      }
    });
  });

  $('#disable-fingerprint').click(function() {
    localStorage.removeItem('diario_fingerprint');
    mostrarMensaje('Huella digital deshabilitada', 'success');
  });
  
  // Iniciar verificación de contraseña al cargar
  $(document).ready(function() {
    $('#passwordInput').focus();
    // Configurar el PIN por defecto si no existe
    if (!localStorage.getItem('diario_pin')) {
      localStorage.setItem('diario_pin', DEFAULT_PIN);
    }
  }); 
   </script> 
 </body>
</html>
